\include{settings}

\begin{document}

\include{titlepage}

\tableofcontents
\newpage

\section{Цели работы}

\begin{enumerate}
	\item Изучение основных команд пользовательского интерфейса;
	\item Изучение цикла подготовки и исполнения программ;
	\item Изучение команд и утилит обработки текстов.
\end{enumerate}

\section{Используемая операционная система}

\begin{itemize}
	\item Дистрибутив: Ubuntu 18.04.1 LTS
	\item Процессоры: Intel® Core™ i7-4800MQ CPU @ 2.70GHz × 8
	\item Версия ядра: 4.15.0-34-generic
	\item Установленные интерпретаторы: \code{bash}, \code{dash}, \code{rbash} и \code{sh}
	\item Установленные компиляторы: \code{gcc} и \code{g++}
\end{itemize}

\vspace{-1em}
\section{Интерпретаторы командной строки}

\textbf{Интерпретатор командной строки} -- компьютерная программа, часть операционной системы, обеспечивающая базовые возможности управления компьютером посредством интерактивного ввода команд через интерфейс командной строки или последовательного исполнения пакетных командных файлов. Как правило, при низкоуровневой настройке ОС у пользователя есть возможность менять командный интерпретатор, используемый по умолчанию.

В Linux существует множество командных интерпретаторов. Самый простой из них, появившийся в ранних версиях UNIX, назывался \code{sh} (Bourne Shell) -- по имени автора, Стивена Борна (Stephen Bourne). Со временем его вытеснил более мощный \code{bash} (Bourne Again Shell), который превосходит \code{sh} во всем, особенно в возможностях редактирования командной строки. Помимо них в системе могут быть установлены \code{dash}, \code{rbash} и другие. Интерпретаторы обычно хранятся в директории \code{/bin}.

\vspace{-1em}
\section{Утилиты информации о системе и пользователе}

Единицей действия при с работе с командным интерфейсом является команда. Значением команды служит код завершения. Синтаксис команд в большинстве случаев имеет вид: \code{имя\_команды [флаги] [аргументы]}.

\vspace{-1em}
\subsection{\code{date}}

Команда \code{date} выводит текущую дату.
\lstinputlisting[firstline=1, lastline=2]{basic/1}

\subsection{\code{who}}

Команда \code{who} выводит пользователей, находящиеся в системе и имя текущего пользователя.
\lstinputlisting[firstline=3, lastline=7]{basic/1}

\subsection{\code{tty}}

Команда \code{tty} выводит полное имя файла-терминала, подключенного к стандартному вводу.
\lstinputlisting[firstline=8, lastline=10]{basic/1}

\subsection{\code{logname}}

Команда \code{logname} выводит входное имя пользователя.
\lstinputlisting[firstline=10, lastline=11]{basic/1}

\subsection{\code{uname}}

Команда \code{uname} выводит имя ядра (kernel).
\lstinputlisting[firstline=12, lastline=13]{basic/1}

\subsection{\code{sleep}}

Команда \code{sleep} приостанавливает выполнение на число секунд, указанное первым аргументом. Например, первый вызов привел к 5-секундной задержке, а второй вызов задерживает на 10000 секунд. Чтобы продолжить выполнение был послан сигнал \code{SIGINT} при помощи сочетания клавиш \code{<\caret C>}, сразу после этого появилось приглашение к вводу.
\lstinputlisting{basic/2}

\subsection{\code{man}}

Команда \code{man} используется для получения справочной информации о различных программах, утилитах или функциях. Дополнительным аргументом команды является номер раздела (по умолчанию поиск проводится во всех разделах):
\begin{enumerate}
	\item Выполняемые программы или \code{shell} команды;
	\item Системные вызовы (функции, предоставляемые ядром);
	\item Библиотечные вызовы (функции внутри библиотек);
	\item Специальные файлы (обычно \code{/dev});
	\item Конвенции и форматы файлов (например, \code{/etc/passwd});
	\item Игры;
	\item Разное;
	\item Команды системного администрирования (обычно для \code{root});
	\item Подпрограммы ядра (не стандартизован).
\end{enumerate}
\lstinputlisting[deletekeywords={date, who, tty}]{basic/3}

\section{Утилиты работы с файлами (каталогами) и процессами}

\subsection{\code{ls}}

Команда \code{ls} выводит список файлов и папок в указанной директории. При использовании ключа \code{-l} используется расширенный формат вывода.
\lstinputlisting[inputencoding=cp1251]{basic/4a_ru}

При использовании команды \code{ls} без аргументов выводится содержание текущей директории. При указании пути \code{ls /} выводится содержимое корневого каталога. Директория \code{/bin} содержит исполняемые программы, доступные из командной строки.
\lstinputlisting[inputencoding=cp1251, firstline=3]{basic/5a_ru}

При использовании ключа \code{-d} команда выводит информацию о каталоге, а не о содержимом каталога. С его помощью можно узнать, например, владельца каталога.
\lstinputlisting[inputencoding=cp1251, firstline=9, lastline=16]{basic/5b_ru}

\subsection{\code{cat}}

Команда \code{cat} конкатенирует содержимое файлов и выводит в стандартный поток вывода. Таким образом, если \code{cat} получает несколько аргументов, то выводится содержимое всех файлов друг за другом. 
\lstinputlisting{basic/4b}

\vspace{-1em}
\subsection{\code{mv}}

Команда \code{mv} используется на перемещения или переименования файлов. В приведенном примере, после выполнения команды \code{mv} файл с именем \code{junk} перестает существовать.
\lstinputlisting[firstline=1, lastline=7]{basic/4c}

\vspace{-1em}
\subsection{\code{cp}}

Команда \code{cp} используется для копирования файлов и папок. В приведенном примере, после выполнения команды \code{cp} существует сразу два файла с одинаковых содержанием: \code{bbb} и \code{junk}.
\lstinputlisting[firstline=9, lastline=15]{basic/4c}

\vspace{-1em}
\subsection{\code{rm}}

Команда \code{rm} удаляет файлы и папки. В приведенном примере на вход команде \code{rm} подается два файла: несуществующий \code{junk} и существующий \code{bbb}, в результате чего файл \code{bbb} удаляется и выводится ошибка про файл \code{junk}.
\lstinputlisting[firstline=17, lastline=22]{basic/4c}

\vspace{-1em}
\subsection{\code{pwd}}

Команда \code{pwd} выводит имя текущей директории.
\lstinputlisting[inputencoding=cp1251, firstline=1, lastline=2]{basic/5a_ru}

\vspace{-1em}
\subsection{\code{cd}}

Команда \code{cd} изменяет текущую директорию. При указании в качестве аргумента \code{..} происходит переход в вышележащую директорию.
\lstinputlisting[inputencoding=cp1251, firstline=1, lastline=8]{basic/5b_ru}

\vspace{-1em}
\subsection{\code{mkdir} и \code{rmdir}}

Команда \code{mkdir} создает директорию с заданным именем.
\lstinputlisting[inputencoding=cp1251, firstline=23, lastline=24]{basic/5b_ru}

Команда \code{rmdir} удалет пустую директорию. При указании в качестве аргумента непустой директории выводится соответствующая ошибка.
\lstinputlisting[inputencoding=cp1251, firstline=34, lastline=46]{basic/5b_ru}

\vspace{-1em}
\subsection{\code{ps}}

Команда \code{ps} выводит информацию о процессах, запущенных из терминала текущего пользователя. При использовании ключа \code{-A} выводятся все процессы (вывод команды \code{ps -A} сокращен).
\lstinputlisting[firstline=1, lastline=12]{basic/6}

\section{Утилиты фильтрации и обработки текста}

Существует большое число команд UNIX, которые читают входной поток, выполняют простые операции над ним и записывают результат в выходной поток. Такие программы называются фильтрами. Важной особенностью фильтров является то, что они никогда не изменяют исходных файлов, а лишь выводят на стандартный вывод обработанную информацию. Стандартный вывод также можно переназначить в файл.

\subsection{\code{grep}}

Команда \code{grep} производит поиск по шаблону, заданному регулярным выражением. В приведенном примере выводятся только те строки из вывода \code{ls -l /tmp}, которые соответствуют каталогам.
\lstinputlisting[inputencoding=cp1251]{text/1a_ru}

В данном примере выводятся только те строки из вывода \code{ls -l /tmp}, которые являются выполняемыми для всех файлами.
\lstinputlisting[inputencoding=cp1251]{text/1b_ru}

В приведенном примере выводятся только те строки из вывода \code{ls -l /tmp}, которые принадлежат пользователю root.
\lstinputlisting[inputencoding=cp1251, firstline=1, lastline=4]{text/1c_ru}

В данном примере выводятся только те строки из вывода \code{ls -l /tmp}, которые не принадлежат пользователю root.
\lstinputlisting[inputencoding=cp1251, firstline=5, lastline=9]{text/1c_ru}

\subsection{\code{cut}}

Команда \code{cut} выбирает отдельные поля из строк файла и выводит их в стандартный поток вывода.

В приведенном примере выводятся номера запущенных процессов из данного терминала. 
\lstinputlisting[inputencoding=cp1251]{text/2a_ru}

В данном примере выводится имя, использованное для входа в систему.
\lstinputlisting{text/2b}

\subsection{\code{tr}}

Команда \code{tr} заменяет или удаляет указанные символы и печатает на стандартный поток вывода. В данном примере выводится информация о файлах в текущей директории прописными буквами.
\lstinputlisting{text/3}

\subsection{\code{sort}}

Команда \code{sort} сортирует строки входящие в файл и выдает результат на стандартный поток вывода. В приведенном примере производится сортировка в алфавитном порядке, в порядке увеличения и уменьшения размеров файлов.
\lstinputlisting[inputencoding=cp1251]{text/4_ru}

\vspace{-1em}
\subsection{\code{uniq}}

Команда \code{uniq} читает исходный файл и сравнивает соседние строки. В обычном режиме вторая и последующие копии повторяющейся строки исключаются; остаток поступает в выходной файл, который не должен совпадать с исходным. Для того, чтобы повторяющиеся строки были соседними, входной файл должен быть отсортирован. В приведенном примере выводятся повторяющиеся размеры файлов из каталога \code{/usr/bin}. 
\lstinputlisting{text/7}

\vspace{-1em}
\subsection{\code{cmp}}

Команда \code{cmp} производит побайтное сравнение и прекращает работу при первом несовпадении. В приведенном примере сравниваются файлы исходных текстов и объектные файлы созданных программ на языке \code{C}, при этом выводится номер первого несовпадающего байта.
\lstinputlisting[morekeywords={vaddya@turing}]{text/6}

\subsection{\code{diff}}

Команда \code{diff} выдает на стандартный вывод только те строки файлов, которые нужно изменить, чтобы привести файлы в соответствие друг с другом. В приведенном примере происходит сравнение двух файлов, а результат выводится в виде команд для редактора \code{ed}.
\lstinputlisting[language=none, inputencoding=cp1251,morekeywords={diff, cat}]{text/5_ru}

\section{Конвейер и управляющие операторы}

\subsection{Конвейер}

В ОС UNIX есть возможность направлять выходной поток одной программы на вход другой при помощи оператора \code{|}, организовав таким образом конвейер (pipeline). Запуск конвейера реализован с помощью системного вызова \code{pipe()}. Код возврата конвейера равен коду возврата последней команды. Пример использования конвейера: \code{ls | sort}. Вывод команды \code{ls} перенаправляется на вход команде \code{sort}. В результате в стандартный поток вывода будет выведен отсортированный список файлов и папок данной директории.

\subsection{Управляющие операторы}

Оператор \& используется для того, чтобы организовать исполнение команд в фоновом режиме. Если добавить \& после команды, то оболочка вернет управление пользователю сразу после запуска команды, не дожидаясь, пока выполнение команды завершится. Например, если задать в командной строке \code{command1 \& command2 \&}, то оболочка запустит команду \code{command1}, сразу же затем команду \code{command2}, и затем немедленно вернет управление пользователю.

Операторы \code{||} и \code{\&\&} являются управляющими операторами. Если в командной строке ввести \code{command1 \&\& command2}, то \code{command2} выполняется в том, и только в том случае, если статус выхода из команды \code{command1} равен нулю, что говорит об успешном ее завершении. Аналогично, если командная строка имеет вид \code{command1 || command2}, то команда \code{command2} выполняется тогда, и только тогда, когда статус выхода из команды \code{command1} отличен от нуля.

\section{Цикл обработки программ}

Язык \code{C} тесно связан с ОС UNIX, т.к. первоначально был разработан именно для реализации ядра ОС. В первую очередь, он удобен для задач, использующих системные вызовы, например, для управления памятью и физическими устройствами, организации связи между процессами и т.д. Однако, \code{C} успешно применяется и для реализации программ, не требующих такого непосредственного взаимодействия с ОС.

В Linux команда \code{cc} почти всегда указывает на \code{/usr/bin/gcc} -- GNU компилятор для языка \code{C}. При запуске компилятора выполняется предварительная обработка (preprocessing), компиляция (compiling), сборка (assembly) и компановка (linking) программы. 

Команда вызова компилятора имееет вид: \code{cc <program.c>}. При успешном исходе компиляции после нее будет выполнено редактирование связей и сгенерирован выполняемый файл \code{a.out}. Для управления процессом компиляции и редактирования связей команда \code{сс} имеет несколько опций, в том числе: 
\begin{itemize}
	\item \code{cc -с} --- подавляется фаза редактирования связей, при этом генерируется объектный файл, который может быть использован для редактирования связей с помощью команды \code{сс} без опции \code{-с};
	\item \code{cc -о program} --- выполняемый файл, полученный после редактирования связей, будет иметь имя \code{program}, а не \code{a.out}. 
	\item \code{cc -S} --- останов после компиляции (не выполняя сборку), при этом генерируется ассемблерный код для каждого файла и др.
\end{itemize}

Редактор связей объединяет несколько объектных файлов в один, выполняет настройку ссылок, включает процедуры инициализации и генерирует таблицу имен, используемую отладчиком. Можно выполнять редактирование связей и в случае единственного объектного файла. Команда \code{ld} вызывает редактор связей непосредственно. Однако как правило, вместо нее применяется команда запуска системы компиляции того или иного языка (например, \code{сс}, \code{gcc}, \code{g++}), которая сама вызывает редактор связей.

С помощью текстового редактора \code{nano} была создана \code{C}-программа \code{prog.c}.
\lstinputlisting[inputencoding=cp1251, language=C]{compile/prog.c}

Программа была скомпилирована и выполнена.
\lstinputlisting[firstline=1, lastline=8]{compile/1}

С помощью флага \code{-o} был получен исполняемый файл с именем \code{hello}.
\lstinputlisting[firstline=9, lastline=14]{compile/1}

\newpage

Вывод программы был перенаправлен в файл \code{res}:
\lstinputlisting[firstline=16, lastline=18]{compile/1}

Для изучения передачи информации в \code{С}-программы была создана программа \code{my\_open.c}, открывающая файл, имя котрого передается ей в качестве аргумента, и выводящая в поток стандартного вывода информацию об успешности открытия.
\lstinputlisting[inputencoding=cp1251, language=C]{compile/my_open_ru.c}

Программа была скомпилирована и протестирована при разных входных данных (существующий, несуществующий и неуказанный файл).
\lstinputlisting[inputencoding=cp1251]{compile/2_ru}

Выводимая программой \code{prog.c} строка была изменена на имя существующего файла в данной директории \code{res}. С помощью команды \code{./file\_name | ./my\_open} был организован конвейер: строка \code{res}, выводимая командой \code{./file\_name}, была подана на вход программе \code{./my\_open}, которая открывала файл \code{res}. При этом использование управляющих опеаторов \code{||} и \code{\&\&} не привело к созданию конвейера, потому что поток вывода одной программы не был направлен на поток ввода другой.

\newpage
 
\lstinputlisting[inputencoding=cp1251]{compile/3_ru}

\section{Выводы}

В процессе выполнения данной работы:
\begin{itemize}
	\item рассмотрены основные интерпретаторы командной строки (\code{bash}, \code{sh});
	\item изучены основные команды интерфейса командной строки, позволяющие получить информацию о системе и пользователе, утилиты для работы с файлами, директориями и процессами, а также утилиты, предназначенные для фильтрации и обработки текста;
	\item изучены и применены на практике управляющие операторы (\code{\&}, \code{\&\&}, \code{||}) и оператор создания конвейера (\code{|});
	\item на примере компилятора \code{cc} рассмотрен цикл подготовки и исполнения программ на языке \code{C}, включающий предварительную обработку, компиляцию, сборку и компоновку.
\end{itemize}

\end{document}
